# Environment Configuration for Figma Integration
# Copy to .env.figma and fill in your actual values

# ============= Figma Configuration =============

# Personal Access Token from Figma Settings ‚Üí Tokens
# Required scopes: file_content:read, webhooks:write, file_key:read
FIGMA_TOKEN=figd_your_token_here_replace_with_actual_token

# Figma Team ID (from Figma settings)
# Format: typically 12+ characters
FIGMA_TEAM_ID=your_team_id_here

# Figma File Key (from your design file URL)
# URL: https://www.figma.com/design/FILE_KEY/...
# Example from your project: qqeukvj1InYIsaVBsMGCB6
FIGMA_FILE_KEY=qqeukvj1InYIsaVBsMGCB6

# ============= GitHub Configuration =============

# GitHub Personal Access Token
# Required scopes: repo (all), workflow
# Generate at: https://github.com/settings/tokens
GITHUB_TOKEN=ghp_your_token_here_replace_with_actual_token

# Repository owner (username or organization)
GITHUB_REPO_OWNER=NickScherbakov

# Repository name
GITHUB_REPO_NAME=codementor-ai-platform

# ============= WebHook Configuration =============

# Secret key for validating WebHook signatures
# Generate: `openssl rand -hex 32`
WEBHOOK_SECRET=your_random_secret_here_at_least_32_characters

# Full URL where Figma will send WebHook events
# Must be accessible from the internet
# Format: https://yourdomain.com/api/webhooks/figma
WEBHOOK_URL=https://your-domain.com/api/webhooks/figma

# ============= Server Configuration =============

# Node environment
NODE_ENV=development

# Port for MCP Server
PORT=3333

# Log level: debug, info, warn, error
LOG_LEVEL=info

# ============= Optional: Advanced Configuration =============

# Cache TTL for Figma API responses (in seconds)
FIGMA_CACHE_TTL=3600

# Max retries for API calls
MAX_RETRIES=3

# Retry delay in milliseconds
RETRY_DELAY=1000

# Rate limit threshold for Figma API (requests per minute)
FIGMA_RATE_LIMIT=120

# Rate limit threshold for GitHub API (requests per hour)
GITHUB_RATE_LIMIT=5000

# ============= Optional: Monitoring =============

# Prometheus metrics endpoint enable
ENABLE_METRICS=true

# Sentry DSN for error tracking
SENTRY_DSN=

# ============= Optional: Email Notifications =============

# Send email when PR is created
ENABLE_EMAIL_NOTIFICATIONS=false

# Email service configuration
EMAIL_SERVICE=gmail
EMAIL_USER=
EMAIL_PASS=

# Recipient email for notifications
NOTIFICATION_EMAIL=developer@example.com

# ============= Optional: Slack Notifications =============

# Send Slack message when component is generated
ENABLE_SLACK_NOTIFICATIONS=false

# Slack webhook URL
SLACK_WEBHOOK_URL=

# Slack channel
SLACK_CHANNEL=#figma-integration

# ============= Important Security Notes =============

# üîê NEVER commit this file to Git! 
# Add to .gitignore: .env.figma
#
# üîê Store sensitive values in:
# - GitHub Secrets (for CI/CD)
# - Environment variables (for local development)
# - Secrets manager (for production: HashiCorp Vault, AWS Secrets Manager, etc.)
#
# üîê Rotate tokens regularly (every 3-6 months)
#
# üîê Use GitHub Apps instead of Personal Access Tokens for production
# Apps have better rate limits and more granular permissions
#
# üîê Restrict token scopes to minimum required:
# ‚úÖ Figma: file_content:read, webhooks:write
# ‚úÖ GitHub: repo (required), workflow (required), read:user (optional)
#
# üîê Monitor token usage in:
# - Figma: Settings ‚Üí Personal access tokens ‚Üí Activity
# - GitHub: Settings ‚Üí Developer settings ‚Üí Personal access tokens ‚Üí Activity

# ============= Instructions =============

# To use this file:
# 
# 1. Copy this file:
#    cp .env.figma.example .env.figma
#
# 2. Get Figma Token:
#    - Go to: https://www.figma.com/settings/tokens
#    - Create new token with required scopes
#    - Copy token value
#
# 3. Get GitHub Token:
#    - Go to: https://github.com/settings/tokens
#    - Create new token (classic)
#    - Select scopes: repo, workflow
#    - Copy token value
#
# 4. Generate Webhook Secret:
#    macOS/Linux: openssl rand -hex 32
#    Windows: powershell -Command "[Convert]::ToBase64String((1..32|%{[byte]$_})|?{$_ -ne 0})"
#
# 5. Set your domain and webhook URL:
#    WEBHOOK_URL=https://your-domain.com/api/webhooks/figma
#
# 6. Load environment:
#    export $(cat .env.figma | xargs)
#
# 7. Verify configuration:
#    npm run verify-env
#    (script should check all required variables are set)

# ============= Testing =============

# After setting up .env.figma, test with:
#
# 1. Test Figma connection:
#    curl -H "X-Figma-Token: $FIGMA_TOKEN" \
#      https://api.figma.com/v1/files/qqeukvj1InYIsaVBsMGCB6
#
# 2. Test GitHub connection:
#    curl -H "Authorization: token $GITHUB_TOKEN" \
#      https://api.github.com/user
#
# 3. Start MCP Server:
#    npm run dev
#
# 4. Check health:
#    curl http://localhost:3333/health
#
# 5. View available tools:
#    curl http://localhost:3333/info

# ============= Troubleshooting =============

# Problem: "Invalid token" from Figma
# Solution: 
# - Verify token is not expired
# - Check token has required scopes
# - Re-generate token if needed
#
# Problem: "Repository not found" from GitHub
# Solution:
# - Verify GITHUB_REPO_OWNER and GITHUB_REPO_NAME
# - Check token has repo scope
# - Verify token is not expired
#
# Problem: WebHook not being delivered
# Solution:
# - Verify WEBHOOK_URL is publicly accessible
# - Check firewall/VPN rules
# - Verify WEBHOOK_SECRET matches in Figma settings
# - Check MCP Server is running on correct port
#
# Problem: "Rate limit exceeded"
# Solution:
# - Implement exponential backoff in code
# - Add caching to reduce API calls
# - Use GitHub App instead of Personal Token
